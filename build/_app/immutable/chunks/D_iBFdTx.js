import{az as u}from"./I5jpou1v.js";function R(t,n,e,i){if(typeof n=="function"?t!==n||!0:!n.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?i:e==="a"?i.call(t):i?i.value:n.get(t)}function A(t,n,e,i,s){if(typeof n=="function"?t!==n||!0:!n.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n.set(t,e),e}var f;async function o(t,n={},e){return window.__TAURI_INTERNALS__.invoke(t,n,e)}class k{get rid(){return R(this,f,"f")}constructor(n){f.set(this,void 0),A(this,f,n)}async close(){return o("plugin:resources|close",{rid:this.rid})}}f=new WeakMap;var r;(function(t){t[t.Audio=1]="Audio",t[t.Cache=2]="Cache",t[t.Config=3]="Config",t[t.Data=4]="Data",t[t.LocalData=5]="LocalData",t[t.Document=6]="Document",t[t.Download=7]="Download",t[t.Picture=8]="Picture",t[t.Public=9]="Public",t[t.Video=10]="Video",t[t.Resource=11]="Resource",t[t.Temp=12]="Temp",t[t.AppConfig=13]="AppConfig",t[t.AppData=14]="AppData",t[t.AppLocalData=15]="AppLocalData",t[t.AppCache=16]="AppCache",t[t.AppLog=17]="AppLog",t[t.Desktop=18]="Desktop",t[t.Executable=19]="Executable",t[t.Font=20]="Font",t[t.Home=21]="Home",t[t.Runtime=22]="Runtime",t[t.Template=23]="Template"})(r||(r={}));var d;(function(t){t[t.Start=0]="Start",t[t.Current=1]="Current",t[t.End=2]="End"})(d||(d={}));function U(t){return{isFile:t.isFile,isDirectory:t.isDirectory,isSymlink:t.isSymlink,size:t.size,mtime:t.mtime!==null?new Date(t.mtime):null,atime:t.atime!==null?new Date(t.atime):null,birthtime:t.birthtime!==null?new Date(t.birthtime):null,readonly:t.readonly,fileAttributes:t.fileAttributes,dev:t.dev,ino:t.ino,mode:t.mode,nlink:t.nlink,uid:t.uid,gid:t.gid,rdev:t.rdev,blksize:t.blksize,blocks:t.blocks}}function v(t){const n=new Uint8ClampedArray(t),e=n.byteLength;let i=0;for(let s=0;s<e;s++){const a=n[s];i*=256,i+=a}return i}class T extends k{async read(n){if(n.byteLength===0)return 0;const e=await o("plugin:fs|read",{rid:this.rid,len:n.byteLength}),i=v(e.slice(-8)),s=e instanceof ArrayBuffer?new Uint8Array(e):e;return n.set(s.slice(0,s.length-8)),i===0?null:i}async seek(n,e){return await o("plugin:fs|seek",{rid:this.rid,offset:n,whence:e})}async stat(){const n=await o("plugin:fs|fstat",{rid:this.rid});return U(n)}async truncate(n){await o("plugin:fs|ftruncate",{rid:this.rid,len:n})}async write(n){return await o("plugin:fs|write",{rid:this.rid,data:n})}}async function C(t,n){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");const e=await o("plugin:fs|create",{path:t instanceof URL?t.toString():t,options:n});return new T(e)}async function F(t,n){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");await o("plugin:fs|mkdir",{path:t instanceof URL?t.toString():t,options:n})}async function S(t,n){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");const e=await o("plugin:fs|read_text_file",{path:t instanceof URL?t.toString():t,options:n}),i=e instanceof ArrayBuffer?e:Uint8Array.from(e);return new TextDecoder().decode(i)}async function L(t,n,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");const i=new TextEncoder;await o("plugin:fs|write_text_file",i.encode(n),{headers:{path:encodeURIComponent(t instanceof URL?t.toString():t),options:JSON.stringify(e)}})}async function p(t,n){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");return await o("plugin:fs|exists",{path:t instanceof URL?t.toString():t,options:n})}const w=u([{name:"Cnh",cards:[]},{name:"Goweil",cards:[]},{name:"General",cards:[]}]),m=u([{name:"Cnh",cards:[]},{name:"Goweil",cards:[]}]),g=u([]),b=u([]),h=u([]);async function E(){await p("data",{baseDir:r.Desktop})||(console.log("Data folder does not exist, creating one.."),await F("data",{baseDir:r.Desktop}));const n=["achats.txt","clients.txt","entretiens.txt","livraisons.txt","pointages.txt"];for(const e of n){const i=`data\\${e}`;if(!await p(i,{baseDir:r.Desktop})){const a=await C(i,{baseDir:r.Desktop});await L(i,"[]",{baseDir:r.Desktop}),await a.close()}}}async function l(t,n){if(await E(),!!t)try{await L(`data\\${n}.txt`,JSON.stringify(t,null,2),{baseDir:r.Desktop})}catch(e){console.error(`Error saving ${n}:`,e)}}async function c(t){await E(),console.log("Loading data from file ..");try{const n=await S(`data\\${t}.txt`,{baseDir:r.Desktop});return JSON.parse(n)}catch(n){return console.error(`Error loading ${t}:`,n),[]}}async function _(){try{const[t,n,e,i,s]=await Promise.all([c("achats"),c("clients"),c("entretiens"),c("livraisons"),c("pointages")]);return{achatsData:t,clientsData:n,entretiensData:e,livraisonsData:i,pointagesData:s}}catch(t){return console.error("Error loading stores:",t),{achatsData:[],clientsData:[],entretiensData:[],livraisonsData:[],pointagesData:[]}}}let x=!1;async function y(){if(!x){try{const{achatsData:t,clientsData:n,entretiensData:e,livraisonsData:i,pointagesData:s}=await _();w.set(t),g.set(n),m.set(e),b.set(i),h.set(s),w.subscribe(a=>l(a,"achats")),g.subscribe(a=>l(a,"clients")),m.subscribe(a=>l(a,"entretiens")),b.subscribe(a=>l(a,"livraisons")),h.subscribe(a=>l(a,"pointages"))}catch(t){console.error("Error initializing stores:",t)}x=!0}}export{w as a,g as c,m as e,y as i,b as l,h as p};
