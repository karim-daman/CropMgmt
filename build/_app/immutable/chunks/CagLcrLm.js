import{ag as f}from"./CmPZlwSp.js";function k(t,n,e,i){if(typeof n=="function"?t!==n||!0:!n.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?i:e==="a"?i.call(t):i?i.value:n.get(t)}function U(t,n,e,i,a){if(typeof n=="function"?t!==n||!0:!n.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n.set(t,e),e}var d;async function o(t,n={},e){return window.__TAURI_INTERNALS__.invoke(t,n,e)}class v{get rid(){return k(this,d,"f")}constructor(n){d.set(this,void 0),U(this,d,n)}async close(){return o("plugin:resources|close",{rid:this.rid})}}d=new WeakMap;var r;(function(t){t[t.Audio=1]="Audio",t[t.Cache=2]="Cache",t[t.Config=3]="Config",t[t.Data=4]="Data",t[t.LocalData=5]="LocalData",t[t.Document=6]="Document",t[t.Download=7]="Download",t[t.Picture=8]="Picture",t[t.Public=9]="Public",t[t.Video=10]="Video",t[t.Resource=11]="Resource",t[t.Temp=12]="Temp",t[t.AppConfig=13]="AppConfig",t[t.AppData=14]="AppData",t[t.AppLocalData=15]="AppLocalData",t[t.AppCache=16]="AppCache",t[t.AppLog=17]="AppLog",t[t.Desktop=18]="Desktop",t[t.Executable=19]="Executable",t[t.Font=20]="Font",t[t.Home=21]="Home",t[t.Runtime=22]="Runtime",t[t.Template=23]="Template"})(r||(r={}));var p;(function(t){t[t.Start=0]="Start",t[t.Current=1]="Current",t[t.End=2]="End"})(p||(p={}));function T(t){return{isFile:t.isFile,isDirectory:t.isDirectory,isSymlink:t.isSymlink,size:t.size,mtime:t.mtime!==null?new Date(t.mtime):null,atime:t.atime!==null?new Date(t.atime):null,birthtime:t.birthtime!==null?new Date(t.birthtime):null,readonly:t.readonly,fileAttributes:t.fileAttributes,dev:t.dev,ino:t.ino,mode:t.mode,nlink:t.nlink,uid:t.uid,gid:t.gid,rdev:t.rdev,blksize:t.blksize,blocks:t.blocks}}function C(t){const n=new Uint8ClampedArray(t),e=n.byteLength;let i=0;for(let a=0;a<e;a++){const l=n[a];i*=256,i+=l}return i}class F extends v{async read(n){if(n.byteLength===0)return 0;const e=await o("plugin:fs|read",{rid:this.rid,len:n.byteLength}),i=C(e.slice(-8)),a=e instanceof ArrayBuffer?new Uint8Array(e):e;return n.set(a.slice(0,a.length-8)),i===0?null:i}async seek(n,e){return await o("plugin:fs|seek",{rid:this.rid,offset:n,whence:e})}async stat(){const n=await o("plugin:fs|fstat",{rid:this.rid});return T(n)}async truncate(n){await o("plugin:fs|ftruncate",{rid:this.rid,len:n})}async write(n){return await o("plugin:fs|write",{rid:this.rid,data:n})}}async function y(t,n){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");const e=await o("plugin:fs|create",{path:t instanceof URL?t.toString():t,options:n});return new F(e)}async function S(t,n){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");await o("plugin:fs|mkdir",{path:t instanceof URL?t.toString():t,options:n})}async function _(t,n){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");const e=await o("plugin:fs|read_text_file",{path:t instanceof URL?t.toString():t,options:n}),i=e instanceof ArrayBuffer?e:Uint8Array.from(e);return new TextDecoder().decode(i)}async function R(t,n,e){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");const i=new TextEncoder;await o("plugin:fs|write_text_file",i.encode(n),{headers:{path:encodeURIComponent(t instanceof URL?t.toString():t),options:JSON.stringify(e)}})}async function w(t,n){if(t instanceof URL&&t.protocol!=="file:")throw new TypeError("Must be a file URL.");return await o("plugin:fs|exists",{path:t instanceof URL?t.toString():t,options:n})}const g=f([{name:"Cnh",achat:[]},{name:"Goweil",achat:[]},{name:"General",achat:[]}]),m=f([{name:"Cnh",cards:[]},{name:"Goweil",cards:[]}]),b=f([]),h=f([]),x=f([]),L=f([]);async function A(){await w("data",{baseDir:r.Desktop})||(console.log("Data folder does not exist, creating one.."),await S("data",{baseDir:r.Desktop}));const n=["achats.txt","clients.txt","entretiens.txt","livraisons.txt","pointages.txt","history.txt"];for(const e of n){const i=`data\\${e}`;if(!await w(i,{baseDir:r.Desktop})){const l=await y(i,{baseDir:r.Desktop});await R(i,"[]",{baseDir:r.Desktop}),await l.close()}}}async function c(t,n){if(await A(),!!t)try{await R(`data\\${n}.txt`,JSON.stringify(t,null,2),{baseDir:r.Desktop})}catch(e){console.error(`Error saving ${n}:`,e)}}async function u(t){await A(),console.log("Loading data from file ..");try{const n=await _(`data\\${t}.txt`,{baseDir:r.Desktop});return JSON.parse(n)}catch(n){return console.error(`Error loading ${t}:`,n),[]}}async function D(){try{const[t,n,e,i,a,l]=await Promise.all([u("achats"),u("clients"),u("entretiens"),u("livraisons"),u("pointages"),u("history")]);return{achatsData:t,clientsData:n,entretiensData:e,livraisonsData:i,pointagesData:a,historyData:l}}catch(t){return console.error("Error loading stores:",t),{achatsData:[],clientsData:[],entretiensData:[],livraisonsData:[],pointagesData:[],historyData:[]}}}let E=!1;async function P(){if(!E){try{const{achatsData:t,clientsData:n,entretiensData:e,livraisonsData:i,pointagesData:a,historyData:l}=await D();g.set(t),b.set(n),m.set(e),h.set(i),x.set(a),L.set(l),g.subscribe(s=>c(s,"achats")),b.subscribe(s=>c(s,"clients")),m.subscribe(s=>c(s,"entretiens")),h.subscribe(s=>c(s,"livraisons")),x.subscribe(s=>c(s,"pointages")),L.subscribe(s=>c(s,"history"))}catch(t){console.error("Error initializing stores:",t)}E=!0}}export{g as a,b as c,m as e,L as h,P as i,h as l,x as p};
